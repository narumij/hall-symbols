module Crystallography.HallSymbols.LikeITC (
--  generatorSelected,
  generatorsSelected,
  generatorsSelectedTable,
  symmetryOperations,
  ) where

import Data.Maybe
import Data.List (nub)
import Data.Matrix

import Data.Matrix.SymmetryOperationsSymbols

import Crystallography.HallSymbols
import Crystallography.HallSymbols.SpacegroupSymbols

import Data.Matrix.AsXYZ
import Data.Matrix.SymmetryOperationsSymbols

generateLikeITC' selected = nub $ gen [] selected
  where
    gen a  []    = a
    gen [] (b:c) = gen [b] c
    gen a  (b:c) = gen (a ++ multSymop b a) c

generateLikeITC selected = nub $ gen [] selected
  where
    gen a  []    = a
    gen [] (b:c) = gen [b] c
    gen a  (b:c) | is3 b = gen (apply' b a) c
                 | is3r b = gen (apply' b a) c
                 | otherwise = gen (apply b a) c
apply b a = a ++ multSymop b a
apply' b a = a ++ multSymop b a ++ multSymop b (multSymop b a)
is3 m = (submatrix 1 3 1 3 m) == (submatrix 1 3 1 3 (fromXYZ "-y,x-y,z"))
is3r m = (submatrix 1 3 1 3 m) == (submatrix 1 3 1 3 (fromXYZ "z,x,y"))

debugPrint :: [[Matrix Rational]] -> IO ()
debugPrint mm = mapM_ putStrLn hoge
  where
    hoge :: [String]
    hoge = concat $ map fromMatrix' h
    h :: [Matrix Rational]
    h = concat mm

generatorsSelected numberAndChoice = case select <$> symop <*> indices of
  Just a -> a
  Nothing -> []
  where
    symbol = fromNumberAndChoice numberAndChoice
    symop = fromHallSymbols' <$> symbol
    indices = selectGeneratorIndices numberAndChoice

generatorsSelected' numberAndChoice = case select' <$> symop <*> indices of
  Just a -> a
  Nothing -> []
  where
    symbol = fromNumberAndChoice numberAndChoice
    symop = fromHallSymbols' <$> symbol
    indices = selectGeneratorIndices numberAndChoice

symmetryOperations numberAndChoice = map generateLikeITC $ generatorsSelected' numberAndChoice

symmetryOperations' numberAndChoice = map generateLikeITC' $ generatorsSelected' numberAndChoice

selectGeneratorIndices numberAndChoice = lookup numberAndChoice generatorsSelectedTable

select symops (a,b) = [[ symops !! n | n <- idx] | idx <- indices]
  where
    indices = [a,b]

select' symops (a,b) = [[ symops !! n | n <- idx] | idx <- indices]
  where
    indices = [ [c] ++ b | c <- a]

generatorsSelectedTable :: [([Char], ([Int], [Int]))]
generatorsSelectedTable = [

  ("1", ([0],[])),

  ("2", ([0],[1])),

  ("3:b", ([0],[1])),
  ("3:c", ([0],[1])),

  ("4:b",([0],[1])),
  ("4:c",([0],[1])),

  ("5:b1",([0,1],[2])),
  ("5:b2",([0,1],[2])),
  ("5:b3",([0,1],[2])),

  ("5:c1",([0,1],[2])),
  ("5:c2",([0,1],[2])),
  ("5:c3",([0,1],[2])),

  ("6:b",([0],[1])),
  ("6:c",([0],[1])),

  ("7:b1",([0],[1])),
  ("7:b2",([0],[1])),
  ("7:b3",([0],[1])),
  ("7:c1",([0],[1])),
  ("7:c2",([0],[1])),
  ("7:c3",([0],[1])),

  ("8:b1",([0,1],[2])),
  ("8:b2",([0,1],[2])),
  ("8:b3",([0,1],[2])),
  ("8:c1",([0,1],[2])),
  ("8:c2",([0,1],[2])),
  ("8:c3",([0,1],[2])),

  ("9:b1",([0,1],[2])),
  ("9:b2",([0,1],[2])),
  ("9:b3",([0,1],[2])),
  ("9:c1",([0,1],[2])),
  ("9:c2",([0,1],[2])),
  ("9:c3",([0,1],[2])),

  ("10:b",([0],[2,1])),
  ("10:c",([0],[2,1])),

  ("11:b",([0],[2,1])),
  ("11:c",([0],[2,1])),

-- TODO:CHECK
  ("12:b1",([0,1],[4,2])),
  ("12:b2",([0,1],[4,2])),
  ("12:b3",([0,1],[4,2])),
  ("12:c1",([0,1],[4,2])),
  ("12:c2",([0,1],[4,2])),
  ("12:c3",([0,1],[4,2])),

-- TODO:CHECK
  ("13:b1",([0],[2,1])),
  ("13:b2",([0],[2,1])), 
  ("13:b3",([0],[2,1])),
  ("13:c1",([0],[2,1])),
  ("13:c2",([0],[2,1])),
  ("13:c3",([0],[2,1])),

-- TODO:CHECK
  ("14:b1",([0],[2,1])),
  ("14:b2",([0],[2,1])),
  ("14:b3",([0],[2,1])),
  ("14:c1",([0],[2,1])),
  ("14:c2",([0],[2,1])),
  ("14:c3",([0],[2,1])),

-- TODO:CHECK
  ("15:b1",([0,1],[4,2])),
  ("15:b2",([0,1],[4,2])),
  ("15:b3",([0,1],[4,2])),
  ("15:c1",([0,1],[4,2])),
  ("15:c2",([0,1],[4,2])),
  ("15:c3",([0,1],[4,2])),

  ("16",([0],[1,3])),

  ("17",([0],[1,3])),

  ("18",([0],[1,3])),

  ("19",([0],[1,3])),

  ("20",([0,1],[2,6])),

  ("21",([0,1],[2,6])),

  ("22",([0,1,2,3],[4,12,5])),

  ("23",([0,1],[2,6,3])),

  ("24",([0,1],[4,6])),

  ("25",([0],[1,3])),

  ("26",([0],[1,3])),

  ("27",([0],[1,3])),

  ("28",([0],[1,3])),

  ("29",([0],[1,3])),

  ("30",([0],[1,3])),

  ("31",([0],[1,3])),

  ("32",([0],[1,3])),

  ("33",([0],[1,3])),

  ("34",([0],[1,3])),

  ("35",([0,1],[2,6])),

  ("36",([0,1],[2,6])),

  ("37",([0,1],[2,6])),

  ("38",([0,1],[2,6])),

  ("39",([0,1],[2,7])),

  ("40",([0,1],[2,6])),

  ("41",([0,1],[2,7])),

  ("42",([0,1,2,3],[4,12])),

  ("43",([0,1,2,3],[4,13])),

  ("44",([0,1],[2,6])),

  ("45",([0,1],[2,7])),

  ("46",([0,1],[2,6])),

  ("47",([0],[2,6,1])),

  ("48:1",([0],[1,4,2,3])),
  ("48:2",([0],[2,6,3,1])),

  ("49",([0],[2,6,1])),

  ("50:1",([0],[1,4,3])),
  ("50:2",([0],[2,6,1])),

  ("51",([0],[2,6,1])),

  ("52",([0],[2,6,1])),

  ("53",([0],[2,6,1])),

  ("54",([0],[2,6,1])),

  ("55",([0],[2,6,1])),

  ("56",([0],[2,6,1])),

  ("57",([0],[2,6,1])),

  ("58",([0],[2,6,1])),

  ("59:1",([0],[1,4,3])),
  ("59:2",([0],[2,6,1])),

  ("60",([0],[2,6,1])),

  ("61",([0],[2,6,1])),

  ("62",([0],[2,6,1])),

  ("63",([0,1],[4,12,2])),

  ("64",([0,1],[4,12,2])),

  ("65",([0,1],[4,12,2])),

  ("66",([0,1],[4,12,2])),

  ("67",([0,1],[4,12,2])),

  ("68:1",([0,1],[5,8,4])),
  ("68:2",([0,1],[6,12,2])),

  ("69",([0,1,2,3],[8,24,4])),

  ("70:1",([0,1,2,3],[4,16,5,6])),
  ("70:2",([0,1,2,3],[14,26,4])),

  ("71",([0,1],[4,12,5,2])),

  ("72",([0,1],[4,13,3])),

  ("73",([0,1],[6,12,2])),

  ("74",([0,1],[4,12,2])),

  ("75",([0],[2,1])),

  ("76",([0],[2,1])),

  ("77",([0],[2,1])),

  ("78",([0],[2,1])),

  ("79",([0,1],[4,2])),

  ("80",([0,1],[4,2])),

  ("81",([0],[2,1])),

  ("82",([0,1],[4,2])),

  ("83",([0],[4,2,1])),

  ("84",([0],[4,2,1])),

  ("85:1",([0],[3,1,2])),
  ("85:2",([0],[4,2,1])),

  ("86:1",([0],[3,1,2])),
  ("86:2",([0],[4,2,1])),

  ("87",([0,1],[8,4,3])),

  ("88:1",([0,1],[6,2,3])),
  ("88:2",([0,1],[8,4,2])),

  ("89",([0],[3,1,7])),

  ("90",([0],[3,1,7])),

  ("91",([0],[3,1,7])),

  ("92",([0],[3,1,7])),

  ("93",([0],[3,1,7])),

  ("94",([0],[3,1,7])),

  ("95",([0],[3,1,7])),

  ("96",([0],[3,1,7])),

  ("97",([0,1],[6,2,13])),

  ("98",([0,1],[6,2,13])),

  ("99",([0],[3,1,7])),

  ("100",([0],[3,1,7])),

  ("101",([0],[3,1,7])),

  ("102",([0],[3,1,7])),

  ("103",([0],[3,1,7])),

  ("104",([0],[3,1,7])),

  ("105",([0],[3,1,7])),

  ("106",([0],[3,1,7])),

  ("107",([0,1],[6,2,13])),

  ("108",([0,1],[6,2,13])),

  ("109",([0,1],[6,2,13])),

  ("110",([0,1],[6,2,13])),

  ("111",([0],[3,1,7])),

  ("112",([0],[3,1,7])),

  ("113",([0],[3,1,7])),

  ("114",([0],[3,1,7])),

  ("115",([0],[3,1,7])),

  ("116",([0],[3,1,7])),

  ("117",([0],[3,1,7])),

  ("118",([0],[3,1,7])),

  ("119",([0,1],[6,2,13])),

  ("120",([0,1],[6,2,13])),

  ("121",([0,1],[6,2,13])),

  ("122",([0,1],[6,2,13])),

  ("123",([0,1],[6,2,13])),

  ("124",([0,1],[6,2,13])),

  ("125:1",([0],[4,1,10,3])),
  ("125:2",([0],[6,2,13,1])),

  ("126:1",([0],[4,1,10,3])),
  ("126:2",([0],[6,2,13,1])),

  ("127",([0],[6,2,13,1])),

  ("128",([0],[6,2,13,1])),

  ("129:1",([0],[4,1,10,3])),
  ("129:2",([0],[6,2,13,1])),

  ("130:1",([0],[4,1,10,3])),
  ("130:2",([0],[6,2,13,1])),

  ("131",([0],[6,2,13,1])),

  ("132",([0],[6,2,13,1])),

  ("133:1",([0],[4,1,10,3])),
  ("133:2",([0],[6,2,13,1])),

  ("134:1",([0],[4,1,10,3])),
  ("134:2",([0],[6,2,13,1])),

  ("135",([0],[6,2,13,1])),

  ("136",([0],[6,2,13,1])),

  ("137:1",([0],[4,1,10,3])),
  ("137:2",([0],[6,2,13,1])),

  ("138:1",([0],[4,1,10,3])),
  ("138:2",([0],[6,2,13,1])),

  ("139",([0,1],[12,4,25,3])),

  ("140",([0,1],[12,4,25,3])),

  ("141:1", ([0,1],[8,2,19,4])),
  ("141:2", ([0,1],[12,4,25,3])),

  ("142:1", ([0,1],[8,2,19,4])),
  ("142:2", ([0,1],[12,4,25,3])),

  ("143", ([0],[1])),
  ("144", ([0],[1])),
  ("145", ([0],[1])),

  ("146:H", ([0,1,2],[3])),
  ("146:R", ([0],[1])),

  ("147", ([0],[2,1])),

  ("148:H", ([0,1,2],[6,3])),
  ("148:R", ([0],[2,1])),

  ("149", ([0],[2,1])),

  ("150", ([0],[2,1])),

  ("151", ([0],[2,1])),

  ("152", ([0],[2,1])),

  ("153", ([0],[2,1])),

  ("154", ([0],[2,1])),

  ("155:H", ([0,1,2],[6,3])),
  ("155:R", ([0],[2,1])),

  ("156", ([0],[2,1])),

  ("157", ([0],[2,1])),

  ("158", ([0],[2,1])),

  ("159", ([0],[2,1])),

  ("160:H", ([0,1,2],[6,3])),
  ("160:R", ([0],[2,1])),

  ("161:H", ([0,1,2],[6,3])),
  ("161:R", ([0],[2,1])),

  ("162", ([0],[2,3,1])),

  ("163", ([0],[2,3,1])),

  ("164", ([0],[2,3,1])),

  ("165", ([0],[2,3,1])),

  ("166:H", ([0,1,2],[6,7,3])),
  ("166:R", ([0],[2,7,1])),

  ("167:H", ([0,1,2],[6,7,3])),
  ("167:R", ([0],[2,7,1])),

  ("168", ([0],[2,3,1])),

  ("169", ([0],[2,3,1])),

  ("170", ([0],[2,3,1])),

  ("171", ([0],[2,3,1])),

  ("172", ([0],[2,3,1])),

  ("173", ([0],[2,3,1])),

  ("174", ([0],[2,3,1])),

  ("176", ([0],[4,6,1])),

-- TODO: CHECK
  ("177", ([0],[2,3,1])),

  ("178", ([0],[2,3,1])),

  ("179", ([0],[2,3,1])),

  ("180", ([0],[2,3,1])),

  ("181", ([0],[2,3,1])),

  ("182", ([0],[2,3,1])),

  ("183", ([0],[2,3,1])),

  ("184", ([0],[2,3,1])),

  ("185", ([0],[2,3,1])),

  ("186", ([0],[2,3,1])),

  ("187", ([0],[2,3,1])),

  ("188", ([0],[2,3,1])),

  ("189", ([0],[2,3,1])),

  ("190", ([0],[2,3,1])),

  ("191", ([0],[6,12,21,1])),

  ("192", ([0],[6,12,21,1])),

  ("193", ([0],[6,12,21,1])),

  ("194", ([0],[6,12,21,1])),

  ("195",([0],[1,4,2,3])),

  ("196",([0,1,2,3],[4,16,6])),

  ("197",([0],[1,4,2,3])),

  ("198",([0],[1,4,2,3])),

  ("199",([0],[1,4,2,3])),

  ("200",([0],[1,4,2,3])),

  ("201:1",([0],[1,4,2,3])),
  ("201:2",([0],[1,4,2,3])),

  ("202",([0,1,2,3],[8,32,10,4])),

  ("203:1",([0,1,2,3],[4,20,6,7])),
  ("203:2",([0,1,2,3],[8,32,10,4])),

  ("204",([0,1],[4,16,6,2])),

  ("205",([0,1],[4,16,6,2])),

  ("206",([0,1],[4,16,6,2])),

  ("207",([0],[1,4,2,3])),

  ("208",([0],[1,4,2,3])),

  ("209",([0,1,2,3],[16,49,6,17])),

  ("210",([0,1,2,3],[16,49,6,17])),

  ("211",([0,1],[4,16,6,2])),

  ("212",([0],[1,4,2,3])),

  ("213",([0],[1,4,2,3])),

  ("214",([0,1],[4,16,6,2])),

  ("215",([0],[1,4,2,3])),

  ("216",([0,1,2,3],[16,49,6,17])),

  ("217",([0,1],[4,16,6,2])),

  ("218",([0],[1,4,2,3])),

  ("219",([0,1,2,3],[16,49,6,17])),

  ("220",([0,1],[4,16,6,2])),

  ("221",([0],[8,25,4,9,1])),

  ("222:1",([0],[5,17,3,6,4])),
  ("222:2",([0],[8,25,4,9,1])),

  ("223",([0],[8,25,4,9,1])),

  ("224:1",([0],[5,17,3,6,4])),
  ("224:2",([0],[8,25,4,9,1])),

  ("225",([0,1,2,3],[32,97,10,33,4])),

  ("226",([0,1,2,3],[32,97,10,33,4])),

  ("227:1",([0,1,2,3],[20,112,6,43,7])),
  ("227:2",([0,1,2,3],[32,97,10,33,4])),

  ("228:1",([0,1,2,3],[32,97,10,33,4])),
  ("228:2",([0,1,2,3],[32,97,10,33,4])),

  ("229",([0,1],[16,49,6,17,2])),

  ("230",([0,1],[16,49,6,17,2]))

  ]

